<!doctype html>

<html lang="en">
<head>
	<title>testbox</title>
	
	<link rel="stylesheet" type="text/css" href="stylesheets/testbox_style.css" media="screen" />
	
    <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
</head>

<body>
	<div id = "render">
	
	<script src="../libs/three.min.js"></script>
	<script src="../libs/stats.min.js"></script>
	<script src="../libs/Detector.js"></script>
	<script src="../libs/OrbitControls.js"></script>
	<script src="../libs/i-color.min.js"></script>    
	<script src="../src/grafar.js"></script>
	<script src="../src/core/fn_utils.js"></script>
	<script src="../src/math/polyfills.js"></script>
	<script src="../src/math/misc.js"></script>
	<script src="../src/core/pool.js"></script>    
	<script src="../src/math/set.js"></script>
	<script src="../src/math/vector.js"></script>
	<script src="../src/math/numerics.js"></script>
	<script src="../src/math/array_utils.js"></script>
	<script src="../src/core/style.js"></script>
	<script src="../src/math/graphdata.js"></script>
	<script src="../src/core/parser_alt.js"></script>    
	<script src="../src/core/reactive.js"></script>
	<script src="../src/core/glutils.js"></script>
	<script src="../src/core/reactive_topo.js"></script>
	<script src="../src/core/reactive_graph.js"></script>
	<script src="../src/core/reactive_object.js"></script>    
	<script src="../src/core/parser_.js"></script>
	<script src="../src/core/panel.js"></script>    
	<script src="../src/legacy/observer.js"></script>
	<script src="../src/legacy/animation.js"></script>
	<script src="../src/legacy/grafar_samples.js"></script>
	<script src="../src/legacy/grafar_ui.js"></script>
    
	<script type="text/javascript">
        var pan3d = new grafar.Panel(document.getElementById('render')),
            bld1 = new grafar.Object().pin(pan3d),
            pi = Math.PI,
            segAng = 3 * pi / 2,
            seg = 9,
            angRescale = 2 * pi / segAng / seg,
            power = 2,
            hScale = 1/3;
        
        pan3d.camera.position.set(-1.3, .47, .7);
        
        
        bld1.constrain({what: 'r', maxlen: 20, as: grafar.logseq(0, 1, 'r')})
            .constrain({what: 'phi', maxlen: 20, as: grafar.seq(-segAng / 2, segAng / 2, 'phi')})
            .constrain({what: 'rep', maxlen: seg, as: grafar.seq(0, 2 * pi, 'rep', true), discrete: true})
            .constrain({what: 'layer', maxlen: 2, as: grafar.seq(0, 1, 'layer'), discrete: true})
            .constrain({what: 'z', using: 'r, phi, rep, layer', as: function(data, l) {
                var r = data.r, phi = data.phi;
                for (var i = 0; i < l; i++)
                    data.z[i] = hScale * Math.pow(r[i], power) * Math.cos(phi[i]) + data.layer[i] / 50;
            }})
            .constrain({what: 'x', using: 'r, phi, rep, layer', as: function(data, l) {
                for (var i = 0; i < l; i++)
                    data.x[i] = Math.cos(data.rep[i] + angRescale * data.phi[i]) * data.r[i];
            }})
            .constrain({what: 'y', using: 'r, phi, rep, layer', as: function(data, l) {
                for (var i = 0; i < l; i++)
                    data.y[i] = Math.sin(data.rep[i] + angRescale * data.phi[i]) * data.r[i];
            }})
            .refresh();
	</script>

	</body>
</html>