<!doctype html>

<html lang="en">
<head>
	<title>testbox</title>

	<link rel="stylesheet" type="text/css" href="stylesheets/testbox_style.css" media="screen" />

    <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
</head>

<body>
	<div id = "render">

    <script type="text/javascript" src="../build/grafar.js"></script>
	<script type="text/javascript">
        var pan3d = new grafar.Panel(document.getElementById('render'));
        var stage = 0;
        var start = Date.now();
        var n = 3;

        // graph.glinstances.forEach(function(gli) {
        //     gli.object.children[2].material.transparent = false;
        //     gli.object.children[0].material.opacity = 1;
        // })
        // point.glinstances[0].object.children[0].material.opacity = 1;
        // point.glinstances[0].object.children[0].material.radius = 10;

        function drawSurf() {
            stage = 2;
            pan3d.setAxes(['x', 'y', 'p']);

            var r = grafar.range(0, 2, 5).select();
            var phi = grafar.range(0, 2 * Math.PI, 70).select();

            var x = grafar.map([r, phi], (r, phi) => Math.cos(phi) * r);
            var y = grafar.map([r, phi, t], (r, phi, t) => Math.sin(phi) * (Math.cos(t + phi) + r));
            var p = grafar.map([t], t => Math.sin(t));

            grafar.pin([x,y,p], pan3d);
        }

        function drawArea() {
            stage = 1;
            pan3d.setAxes(['x', 'y']);

            // graph.glinstances[0].object.children[0].visible = false;

            var r = grafar.range(0, 1, 5).select();
            var phi = grafar.range(0, 2 * Math.PI, 70).select();

            var x = grafar.map([r, phi], (r, phi) => Math.cos(phi) * r);
            var y = grafar.map([r, phi, t], (r, phi, t) => Math.sin(phi) * (Math.cos(n + phi) + r));

            grafar.pin([x, y], pan3d);
        }

        function drawCurve() {
            stage = 0;
            pan3d.setAxes(['x', 'y']);

            // graph.glinstances[0].object.children[0].visible = false;
            // graph.glinstances[0].object.children[1].visible = true;

            var r = grafar.range(1, 1, 5).select();
            var phi = grafar.range(0, 8 * Math.PI, 7000).select();

            var x = grafar.map([phi, t], (phi, t) => Math.cos(phi) - Math.pow(Math.cos(t * phi), 3));
            var y = grafar.map([phi], phi => Math.sin(phi) -  Math.pow(Math.sin(phi), 3));

            grafar.pin([x, y], pan3d);
        }

        function drawPoint() {
            stage = 0;
            pan3d.setAxes(['x', 'y']);

            // point.glinstances[0].object.children[0].visible = true;
            // point.glinstances[0].object.children[0].material.size = 5;
            // point.glinstances[0].object.children[1].visible = false;

            point.constrain('t', grafar.constant(0, 't'), {maxlen: 1})
                .constrain('r', grafar.constant(1, 'r'), {maxlen: 1})
                .constrain('n', grafar.constant(n, 'n'), {maxlen: 1})
                .constrain('x: r, t', function(data, l) {
                    for (var i = 0; i < l; i++)
                        data.x[i] = Math.cos(data.t[i]) * data.r[i];
                })
                .constrain('y: r, t, n', function(data, l) {
                    for (var i = 0; i < l; i++)
                        data.y[i] = Math.sin(data.t[i]) * (Math.cos(data.n[i] * data.t[i]) + data.r[i]);
                });
        }

        function up() {
            var time = (Date.now() - start) / 1500;
            graph.constrain('t', grafar.constant(time, 't'), {maxlen: 1})
                .refresh();
            window.requestAnimationFrame(up);
        };

        drawCurve();
        //drawSurf();
        //drawPoint();
        //setTimeout(drawCurve, 5000);
        //setTimeout(drawArea, 20000);
        //setTimeout(drawSurf, 1300000);
        up();

	</script>

	</body>
</html>
