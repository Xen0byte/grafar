<html>

<head>
	<title>Grafar interface test</title>
	
	<style>
		.option {
			border-left: 2pt solid transparent;
			color: #222222;
		}
		.option:hover {
			border-left: 2pt solid orange;
			color: #000;
		}
	</style>
	
	<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
			displayAlign: "left"//,
			//"HTML-CSS": { linebreaks: { automatic: true, width: "75% container" } }
		});
    </script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>

<body>
	<menu id = 'exampleSelect'>
	</menu>

	<script>
		var exampleSelect = document.getElementById('exampleSelect'),
			examples = [
				['z + x &=& x^2 + y^2+z^2', {type: 'range', name: 'x', value: [-2, 2]}, {type: 'range', name: 'y', value: [-1, 3]}],
				['y &=& a \\cdot \\sin x', 'x &\\in& [-\\pi, \\pi]', {type: 'number', name: 'a', value: 0}]
			],
			lastTarget = null,
			tangles = {};
		
		var toTeX = function(example) {
				if (typeof example === 'string')
					return example;
				if (example.type === 'range') {
					tangles['editable-min-' + example.name] = example.value[0];
					tangles['editable-max-' + example.name] = example.value[1];
					return example.name + ' &\\in& [\\cssId{editable-min-' + example.name + '}{' + example.value[0] + 
						'},\\cssId{editable-max-' + example.name + '}{' + example.value[1] + '}]';
				} else if (example.type === 'number') {
					tangles['editable-val-' + example.name] = example.value;
					return example.name + ' &=& \\cssId{editable-val-' + example.name + '}{' + example.value + '}';
				}				
				return '';
			}, 
			toTexSystem = function(lines) {
				return '$$\\left \\{ \\begin{array}{lcl}' + 
					lines.join('\\\\') + 
					'\\end{array} \\right. $$';
			};
		
		examples.forEach(function(pr) {
			var option = document.createElement('div');
			option.innerHTML = toTexSystem(pr.map(toTeX));
			option.className = 'option';
			exampleSelect.appendChild(option);
		});
		
		var origin = {x: 0, y: 0},
			coeff = 100,
			val = 0,
			staticTarget = null,
			bindTangles = function() {
				Object.keys(tangles).forEach(function(id) {
					var field = document.getElementById(id);
					if (field) field.addEventListener('mousedown', function (event) {
						event.preventDefault();
						var target = event.toElement || event.target;
						while (!/editable-/.test(target.id))
							target = target.parentNode;
						staticTarget = (target.childElementCount === 2? target.lastChild: target);
						document.addEventListener('mousemove', updateDragVal);
						//console.log(target);
					});
				});
			}, updateDragVal = function(event) {
				if (!mouseDown) {
					val = 0;
					document.removeEventListener('mousemove', updateDragVal);
				} else {
					val = (event.clientX - origin.x) / coeff;
					origin.x = event.clientX;
					staticTarget.innerHTML = (Number(staticTarget.innerHTML) + val).toFixed(2);	
				}
			}, mouseDown = 0;
		document.onmouseup = function() { mouseDown = false; };
		document.onmousedown = function() { mouseDown = true; };
		
		MathJax.Hub.Queue(
			['Typeset', MathJax.Hub],
			[bindTangles]
		);
	</script>
</body>

</html>